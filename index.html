<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Live Audio Visualizer</title>
    <style>
        body { background: #181c20; color: #fff; text-align: center; font-family: sans-serif; }
        #controls { margin: 20px; }
        canvas { display: block; margin: 0 auto; background: #222; border-radius: 16px; }
        button { margin: 0 10px; padding: 10px 20px; font-size: 16px; }
    </style>
</head>
<body>
<h1>Live Audio Visualizer</h1>
<div id="controls">
    <button onclick="setMode('waveform')">Waveform</button>
    <button onclick="setMode('frequency')">Frequency</button>
    <button onclick="setMode('circular')">Circular</button>
    <button onclick="toggleMute()">Mute/Unmute</button>
</div>
<canvas id="visualizer" width="800" height="400"></canvas>
<script>
    let audioCtx, analyser, dataArray, bufferLength, source, stream;
    let mode = 'waveform';
    let muted = false;
    const canvas = document.getElementById('visualizer');
    const ctx = canvas.getContext('2d');

    async function setupAudio() {
        stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioCtx.createAnalyser();
        analyser.fftSize = 2048;
        bufferLength = analyser.frequencyBinCount;
        dataArray = new Uint8Array(bufferLength);
        source = audioCtx.createMediaStreamSource(stream);
        source.connect(analyser);
        draw();
    }

    function setMode(newMode) { mode = newMode; }
    function toggleMute() {
        if (audioCtx) {
            if (muted) {
                audioCtx.resume();
            } else {
                audioCtx.suspend();
            }
            muted = !muted;
        }
    }

    function draw() {
        requestAnimationFrame(draw);
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        if (mode === 'waveform') {
            analyser.getByteTimeDomainData(dataArray);
            ctx.lineWidth = 2;
            ctx.strokeStyle = '#00e0ff';
            ctx.beginPath();
            let sliceWidth = canvas.width / bufferLength;
            let x = 0;
            for (let i = 0; i < bufferLength; i++) {
                let v = dataArray[i] / 128.0;
                let y = v * canvas.height / 2;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
                x += sliceWidth;
            }
            ctx.lineTo(canvas.width, canvas.height / 2);
            ctx.stroke();
        } else if (mode === 'frequency') {
            analyser.getByteFrequencyData(dataArray);
            let barWidth = (canvas.width / bufferLength) * 2.5;
            let x = 0;
            for (let i = 0; i < bufferLength; i++) {
                let barHeight = dataArray[i];
                ctx.fillStyle = `hsl(${i / bufferLength * 360}, 100%, 50%)`;
                ctx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);
                x += barWidth + 1;
            }
        } else if (mode === 'circular') {
            analyser.getByteFrequencyData(dataArray);
            let centerX = canvas.width / 2;
            let centerY = canvas.height / 2;
            let radius = Math.min(centerX, centerY) * 0.6;
            let bars = 128;
            for (let i = 0; i < bars; i++) {
                let angle = (i / bars) * 2 * Math.PI;
                let value = dataArray[i] / 255;
                let barLength = radius + value * 100;
                let x1 = centerX + radius * Math.cos(angle);
                let y1 = centerY + radius * Math.sin(angle);
                let x2 = centerX + barLength * Math.cos(angle);
                let y2 = centerY + barLength * Math.sin(angle);
                ctx.strokeStyle = `hsl(${i / bars * 360}, 100%, 60%)`;
                ctx.lineWidth = 4;
                ctx.beginPath();
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
                ctx.stroke();
            }
        }
    }

    setupAudio();
</script>
</body>
</html>
